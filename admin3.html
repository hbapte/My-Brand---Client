<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="./css/style5.css">
</head>
<body>

<div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div>
            <h2>Menu</h2>
            <a href="#">Messages</a>
            <a href="#">Blogs</a>
            <a href="#">Comments</a>
        </div>
        <div>
            <a href="#" onclick="logout()" class="button">Logout</a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h1>Admin dashboard</h1>

        <div>
            <h2>Received Messages</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody id="messagesBody">
                    <!-- Messages will be populated here -->
                </tbody>
            </table>
        </div>

        <div class="blog-container">
            <h2>Published Blogs</h2>
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Content</th>
                        <th>Author</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="blogsBody">
                    <!-- Blogs will be populated here -->
                </tbody>
            </table>
        </div>

        <!-- New Blog Button -->
        <div class="new-blog-button">
            <a href="/new-blog" class="button">New Blog</a>
        </div>
    </div>
</div>

<script>
    async function logout() {
        // Implement logout functionality
        // Redirect the user to the logout endpoint or perform any necessary actions
    }

    async function fetchBlogs() {
        try {
            const response = await fetch('https://my-brand-oxuh.onrender.com/api/blogs');
            const blogs = await response.json();
            const blogsBody = document.getElementById('blogsBody');

            blogs.forEach(blog => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${blog.title}</td>
                    <td>${blog.content}</td>
                    <td>${blog.author}</td>
                    <td>
                        <a href="/edit/${blog._id}" class="button">Edit</a>
                        <button onclick="deleteBlog('${blog._id}')" class="button delete-button">Delete</button>
                    </td>
                `;
                blogsBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching blogs:', error);
        }
    }

    async function deleteBlog(blogId) {
        try {
            const response = await fetch(`https://my-brand-oxuh.onrender.com/api/blogs/${blogId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error('Failed to delete blog');
            }

            // Reload the dashboard after deleting the blog
            window.location.reload();
        } catch (error) {
            console.error('Error deleting blog:', error.message);
            // Handle error: display error message to the user
        }
    }

    // Call function to fetch blogs when the page loads
    window.onload = function() {
        fetchBlogs();
    };
</script>

</body>
</html>
